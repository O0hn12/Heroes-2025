<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f4f4f4;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      form, #searchForm {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      input[type="text"], input[type="number"] {
        padding: 10px;
        margin: 10px 0;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
      }
      button {
        padding: 10px 15px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #218838;
      }
      #suggestions {
        background: white;
        border: 1px solid #ccc;
        border-top: none;
        max-height: 150px;
        overflow-y: auto;
        position: absolute;
        width: calc(100% - 22px);
        z-index: 10;
      }
      #suggestions div {
        padding: 10px;
        cursor: pointer;
      }
      #suggestions div:hover {
        background-color: #f0f0f0;
      }
      #resultsTable {
        margin-top: 20px;
        width: 100%;
        border-collapse: collapse;
      }
      #resultsTable th, #resultsTable td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      #resultsTable th {
        background-color: #f2f2f2;
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const nameInput = document.getElementById("name");
        const suggestions = document.getElementById("suggestions");
        let names = [];

        fetch("https://script.google.com/macros/s/AKfycbyiy7XtFDJJbMTFT3kNYt9vKy7WblKApfz5dQQaRir1fA7mfH8cNHrA5SRvAbRAoo8/exec?action=getNames")
          .then(response => response.json())
          .then(data => {
            names = data.names;
          });

        nameInput.addEventListener("input", function () {
          const inputVal = this.value.toLowerCase();
          suggestions.innerHTML = "";
          if (inputVal.length > 0) {
            const filteredNames = names.filter(name => name.toLowerCase().includes(inputVal));
            filteredNames.forEach(name => {
              const div = document.createElement("div");
              div.textContent = name;
              div.addEventListener("click", function () {
                nameInput.value = name;
                suggestions.innerHTML = "";
              });
              suggestions.appendChild(div);
            });
          }
        });

        document.getElementById("dataForm").addEventListener("submit", function (e) {
          e.preventDefault();
          const name = nameInput.value.trim();
          const number = document.getElementById("number").value;
          if (name && number !== "") {
            google.script.run.withSuccessHandler(() => {
              alert("Data submitted successfully");
              nameInput.value = "";
              document.getElementById("number").value = "";
            }).submitData(name, number);
          } else {
            alert("Please enter both name and number.");
          }
        });

        document.getElementById("searchForm").addEventListener("submit", function (e) {
          e.preventDefault();
          const searchName = document.getElementById("searchName").value;
          if (!searchName) return;
          google.script.run.withSuccessHandler(displayResult).searchName(searchName);
        });

        function displayResult(data) {
          const resultsDiv = document.getElementById("results");
          resultsDiv.innerHTML = "";
          if (data.length === 0) {
            resultsDiv.textContent = "No data found.";
            return;
          }
          const table = document.createElement("table");
          table.id = "resultsTable";
          const thead = document.createElement("thead");
          const headerRow = document.createElement("tr");
          headerRow.innerHTML = `<th>Name</th>${data.slice(1).map((_, i) => `<th>Week ${i + 1}</th>`).join('')}`;
          thead.appendChild(headerRow);
          table.appendChild(thead);

          const tbody = document.createElement("tbody");
          const row = document.createElement("tr");
          row.innerHTML = data.map(cell => `<td>${cell}</td>`).join('');
          tbody.appendChild(row);
          table.appendChild(tbody);
          resultsDiv.appendChild(table);
        }
      });
    </script>
  </head>
  <body>
    <h1>Heroes Adventure 2025</h1>
    <form id="dataForm">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" autocomplete="off" required>
      <div id="suggestions"></div>
      <label for="number">Number (0-5):</label>
      <input type="number" id="number" name="number" min="0" max="5" required>
      <button type="submit">Submit</button>
    </form>

    <form id="searchForm">
      <label for="searchName">Search Name:</label>
      <input type="text" id="searchName" name="searchName">
      <button type="submit">Search</button>
    </form>

    <div id="results"></div>
  </body>
</html>
