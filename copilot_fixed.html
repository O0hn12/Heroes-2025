<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial; margin: 20px; }
      #resultTable { margin-top: 20px; border-collapse: collapse; }
      #resultTable td, #resultTable th { border: 1px solid #ddd; padding: 8px; }
      #resultTable th { background-color: #f2f2f2; }
      input[type="number"] { width: 60px; }
      .suggestions { border: 1px solid #ccc; max-height: 100px; overflow-y: auto; }
      .suggestions div { padding: 5px; cursor: pointer; }
      .suggestions div:hover { background-color: #eee; }
    </style>
  </head>
  <body>
    <h2>Heroes Adventure</h2>

    <label for="name">Name:</label>
    <input type="text" id="nameInput" oninput="showSuggestions()" autocomplete="off">
    <div id="suggestions" class="suggestions"></div>

    <br><br>

    <label for="number">Number (0-5):</label>
    <input type="number" id="numberInput" min="0" max="5">

    <br><br>

    <button onclick="submitForm()" id="submitBtn" disabled>Submit</button>
    <button onclick="searchName()" id="searchBtn" disabled>Search</button>

    <table id="resultTable" style="display: none;"></table>

    <script>
      let allNames = <?= JSON.stringify(allNames) ?>;

      const nameInput = document.getElementById('nameInput');
      const numberInput = document.getElementById('numberInput');
      const submitBtn = document.getElementById('submitBtn');
      const searchBtn = document.getElementById('searchBtn');

      nameInput.addEventListener('input', validateForm);
      numberInput.addEventListener('input', validateForm);

      function validateForm() {
        const name = nameInput.value.trim();
        const number = numberInput.value.trim();
        submitBtn.disabled = !(name && number >= 0 && number <= 5);
        searchBtn.disabled = !name;
      }

      function showSuggestions() {
        const input = nameInput.value.toLowerCase();
        const suggestionBox = document.getElementById('suggestions');
        suggestionBox.innerHTML = '';
        if (input.length === 0) return;

        const matches = allNames.filter(name => name.toLowerCase().includes(input));
        matches.forEach(name => {
          const div = document.createElement('div');
          div.textContent = name;
          div.onclick = () => {
            nameInput.value = name;
            suggestionBox.innerHTML = '';
            validateForm();
          };
          suggestionBox.appendChild(div);
        });
      }

      function submitForm() {
        const name = nameInput.value.trim();
        const number = parseInt(numberInput.value.trim());
        if (name && number >= 0 && number <= 5) {
          google.script.run
            .withSuccessHandler(response => {
              alert("Submitted successfully!");
              nameInput.value = '';
              numberInput.value = '';
              validateForm();
            })
            .processFormData(name, number);
        }
      }

      function searchName() {
        const name = nameInput.value.trim();
        google.script.run.withSuccessHandler(response => {
          const table = document.getElementById("resultTable");
          if (!response.found) {
            table.style.display = "none";
            alert("Name not found.");
            return;
          }

          const headers = ["Name", "Week 1", "Week 2", "Week 3", "Week 4", "Week 5", "Week 6", "Week 7", "Week 8", "Week 9", "Week 10", "Week 11", "Week 12"];
          let html = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
          html += "<tr>" + response.data.map(val => `<td>${val}</td>`).join("") + "</tr>";
          table.innerHTML = html;
          table.style.display = "table";
        }).searchName(name);
      }
    </script>
  </body>
</html>
