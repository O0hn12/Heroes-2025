{"files":[{"id":"ef9714f6-ad1a-49c8-b501-fda1f60b3e5c","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Africa/Cairo\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"97517356-0bb0-40e7-b3a4-d3e15080d58f","name":"Code","type":"server_js","source":"const spreadsheetId \u003d \u00271DPxfNEfgupBq2ZF7s1pXgvVkKQXBJE-Jn1FlIlwhDbE\u0027;\nconst sheetName \u003d \u0027test (Responses)\u0027;\n\nfunction doGet(e) {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027copilot\u0027);\n  const allNames \u003d getAllNames();\n  template.allNames \u003d allNames;\n  return template.evaluate();\n}\n\nfunction getAllNames() {\n  try {\n    const ss \u003d SpreadsheetApp.openById(spreadsheetId);\n    const sheet \u003d ss.getSheetByName(sheetName);\n    const nameColumn \u003d sheet.getRange(\"A:A\").getValues();\n    const uniqueNames \u003d [...new Set(nameColumn.flat().filter(String))]; // Get unique names and remove empty strings\n    return uniqueNames;\n    Logger.log(\u0027Unique Names:\u0027, uniqueNames);\n  } catch (error) {\n    Logger.log(`Error in getAllNames: ${error.message}`);\n    return [];\n  }\n}\n\nfunction processFormData(spreadsheetId, sheetName, identifier, number, useQrNumber, qrNumber) {\n  try {\n    const ss \u003d SpreadsheetApp.openById(spreadsheetId);\n    const sheet \u003d ss.getSheetByName(sheetName);\n\n    let range;\n    let qrRange;\n    let column;\n\n    if (useQrNumber) {\n      column \u003d \"O\"; // البحث في عمود QR Number\n    } else {\n      column \u003d \"A\"; // البحث في عمود الاسم\n    }\n\n    range \u003d sheet.getRange(`${column}:${column}`).getValues();\n    qrRange \u003d sheet.getRange(\"N:O\").getValues(); // العمود QR Number\n    Logger.log(`Range: ${range}`);\n    Logger.log(`QR Range: ${qrRange}`);\n\n    let found \u003d false;\n    let rowIndex \u003d -1;\n    let qrFound \u003d false;\n    let qrRowIndex \u003d -1;\n\n    // Check if the identifier exists in the specified column\n    if (!useQrNumber) {\n      for (let i \u003d 0; i \u003c range.length; i++) {\n        if (range[i][0] \u003d\u003d\u003d identifier) {\n          rowIndex \u003d i + 1;\n          found \u003d true;\n          Logger.log(`Identifier ${identifier} found at row ${rowIndex}`);\n          break;\n        }\n      }\n    }\n\n    // Check if the QR number exists in the QR column\n    if (useQrNumber) {\n      for (let i \u003d 0; i \u003c qrRange.length; i++) {\n        Logger.log(`Checking QR Number ${qrRange[i][0]} against input ${qrNumber}`);\n        if (qrRange[i][0] \u003d\u003d\u003d qrNumber) {\n          qrRowIndex \u003d i + 1;\n          qrFound \u003d true;\n          Logger.log(`QR number ${qrNumber} found at row ${qrRowIndex}`);\n          break;\n        }\n      }\n    }\n\n    // Update the row based on the found status\n    if (qrFound) {\n      processQrNumber(qrNumber, number); // تعديل مرتبط برقم QR\n    } else if (found) {\n      updateRow(sheet, rowIndex, number);\n    } else if (useQrNumber) {\n      Logger.log(`QR Number ${qrNumber} not found, no row updated.`);\n      return { success: false, message: \"QR Number not found!\" };\n    } else {\n      // Add the new name under the last name in column A\n      const lastRowWithName \u003d sheet.getRange(\"A:A\").getValues().filter(row \u003d\u003e row[0] !\u003d\u003d \"\").length;\n      sheet.getRange(lastRowWithName + 1, 1).setValue(identifier); // إضافة الاسم الجديد\n\n      // Add the number in the first column within the range 2-13\n      sheet.getRange(lastRowWithName + 1, 2).setValue(number); // الرقم يذهب لأول عمود\n    }\n\n    // Perform zero-filling for all rows based on the largest column filled\n    zeroFillAllRows(sheet);\n\n    return { success: true };\n  } catch (error) {\n    Logger.log(`Error: ${error.message}`);\n    return { success: false, message: error.message };\n  }\n}\nfunction processQrNumber(qrNumber, newNumber) {\n  try {\n    // التحقق من أن QR Number موجود\n    if (!qrNumber) {\n      Logger.log(\"Error: QR Number is undefined or empty.\");\n      return { success: false, message: \"QR Number is required!\" };\n    }\n\n    const ss \u003d SpreadsheetApp.openById(spreadsheetId);\n    const sheet \u003d ss.getSheetByName(sheetName);\n\n    // قراءة البيانات من عمود QR Number 1 مع تنظيفها وتحويلها لنصوص\n    const qrRange \u003d sheet.getRange(\"O:O\").getValues().map(cell \u003d\u003e cell[0] ? cell[0].toString().trim() : \"\");\n    const inputQrNumber \u003d qrNumber.toString().trim();\n    let targetRow \u003d -1;\n\n    // فحص البيانات عبر Regex وطباعة التفاصيل\n    Logger.log(\"\u003d\u003d\u003d Debugging Comparison with Regex \u003d\u003d\u003d\");\n    Logger.log(`Input QR Number: \u0027${inputQrNumber}\u0027`);\n    for (let i \u003d 0; i \u003c qrRange.length; i++) {\n      const qrInSheet \u003d qrRange[i];\n      Logger.log(`Row ${i + 1}: Comparing QR in Sheet \u003d \u0027${qrInSheet}\u0027 with Input \u003d \u0027${inputQrNumber}\u0027`);\n\n      // استخدام regex للمقارنة\n      if (qrInSheet.match(new RegExp(`^${inputQrNumber}$`))) {\n        Logger.log(\"Match found using regex!\");\n        targetRow \u003d i + 1;\n        break;\n      } else {\n        Logger.log(\"No match at this row.\");\n      }\n    }\n\n    if (targetRow \u003d\u003d\u003d -1) {\n      Logger.log(`QR Number ${inputQrNumber} not found.`);\n      return { success: false, message: \"QR Number not found!\" };\n    }\n\n    Logger.log(`QR Number ${inputQrNumber} found at row ${targetRow}.`);\n\n    // باقي الكود لمعالجة الصف وإضافة الرقم الجديد\n    const rowValues \u003d sheet.getRange(targetRow, 2, 1, 12).getValues()[0];\n    let lastFilledIndex \u003d -1;\n\n    for (let j \u003d 0; j \u003c rowValues.length; j++) {\n      if (rowValues[j] !\u003d\u003d \u0027\u0027) {\n        lastFilledIndex \u003d j;\n      }\n    }\n\n    if (lastFilledIndex + 1 \u003c rowValues.length) {\n      sheet.getRange(targetRow, lastFilledIndex + 3).setValue(newNumber);\n      Logger.log(`Added ${newNumber} to row ${targetRow}, column ${lastFilledIndex + 3}`);\n    } else {\n      Logger.log(\"No more columns available to add the number.\");\n      return { success: false, message: \"No more columns available!\" };\n    }\n\n    for (let j \u003d 0; j \u003c lastFilledIndex; j++) {\n      if (rowValues[j] \u003d\u003d\u003d \u0027\u0027) {\n        sheet.getRange(targetRow, j + 2).setValue(0);\n      }\n    }\n\n    return { success: true, message: \"Number added successfully!\" };\n\n  } catch (error) {\n    Logger.log(`Error: ${error.message}`);\n    return { success: false, message: error.message };\n  }\n}\nfunction zeroFillAllRows(sheet) {\n  const allRows \u003d sheet.getRange(2, 2, sheet.getLastRow() - 1, 12).getValues(); // الأعمدة من 2 إلى 13\n  let maxColumnIndex \u003d -1;\n\n  // تحديد أكبر عمود فيه بيانات\n  for (let i \u003d 0; i \u003c allRows.length; i++) {\n    const currentRow \u003d allRows[i];\n    for (let j \u003d 0; j \u003c currentRow.length; j++) {\n      if (currentRow[j] !\u003d\u003d \u0027\u0027) {\n        maxColumnIndex \u003d Math.max(maxColumnIndex, j);\n      }\n    }\n  }\n\n  // تصفير كل الصفوف حتى العمود الذي يسبق آخر عمود مليان\n  const lastRowWithName \u003d sheet.getRange(\"A:A\").getValues().filter(row \u003d\u003e row[0] !\u003d\u003d \"\").length;\n  for (let i \u003d 2; i \u003c\u003d lastRowWithName; i++) {\n    const row \u003d sheet.getRange(i, 2, 1, 12).getValues()[0];\n    for (let j \u003d 0; j \u003c maxColumnIndex; j++) { // نوقف عند العمود الذي يسبق الأخير\n      if (row[j] \u003d\u003d\u003d \u0027\u0027) {\n        sheet.getRange(i, j + 2).setValue(0); // ملء الخلايا الفارغة بالقيمة 0\n      }\n    }\n  }\n}\n\nfunction updateRow(sheet, rowIndex, number) {\n  const row \u003d sheet.getRange(rowIndex, 2, 1, 12).getValues()[0];\n  let lastFilledIndex \u003d -1;\n\n  // تحديد آخر عمود مليان\n  for (let j \u003d 0; j \u003c row.length; j++) {\n    if (row[j] !\u003d\u003d \u0027\u0027) {\n      lastFilledIndex \u003d j;\n    }\n  }\n\n  // إضافة الرقم في العمود التالي لآخر عمود مليان\n  if (lastFilledIndex + 1 \u003c row.length) {\n    sheet.getRange(rowIndex, lastFilledIndex + 3).setValue(number);\n  } else {\n    Logger.log(\"No more columns available to add the number.\");\n  }\n}\n\nfunction searchName(spreadsheetId, sheetName, identifier) {\n  try {\n    const ss \u003d SpreadsheetApp.openById(spreadsheetId);\n    const sheet \u003d ss.getSheetByName(sheetName);\n\n    const nameRange \u003d sheet.getRange(\"A:A\").getValues();\n    const qrRange \u003d sheet.getRange(\"O:O\").getValues(); // البحث في عمود O\n    let data \u003d [];\n    let found \u003d false;\n\n    for (let i \u003d 0; i \u003c nameRange.length; i++) {\n      if (nameRange[i][0] \u003d\u003d\u003d identifier || qrRange[i][0] \u003d\u003d\u003d identifier) {\n        data \u003d sheet.getRange(i + 1, 1, 1, 13).getValues()[0]; // Get columns A to M\n        found \u003d true;\n        break;\n      }\n    }\n\n    return { data: data, found: found };\n  } catch (error) {\n    Logger.log(`Error: ${error.message}`);\n    return { success: false, message: error.message };\n  }\n}\n\nfunction debugQrColumn() {\n  const ss \u003d SpreadsheetApp.openById(spreadsheetId); // معرف الشيت\n  const sheet \u003d ss.getSheetByName(sheetName); // اسم الصفحة\n  const qrRange \u003d sheet.getRange(\"O:O\").getValues(); // العمود QR Number 1\n\n  for (let i \u003d 0; i \u003c qrRange.length; i++) {\n    Logger.log(`Row ${i + 1}: ${qrRange[i][0]}`); // طباعة كل قيمة موجودة في العمود\n  }\n}\n"},{"id":"d0771562-c584-49a4-9e36-10b14851d3ea","name":"copilot","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n  \u003ctitle\u003eHeroes adventure 2025\u003c/title\u003e\n  \u003cstyle\u003e\n    @import url(\u0027https://fonts.googleapis.com/css2?family\u003d18+Khebrat+Musamim:wght@400;700\u0026display\u003dswap\u0027);\n    @import url(\u0027https://fonts.googleapis.com/css2?family\u003dForte\u0026display\u003dswap\u0027);\n\n    body {\n      background-image: url(\u0027https://i.imgur.com/jKMhKlP.png\u0027);\n      background-size: cover;\n      background-position: center;\n      background-repeat: no-repeat;\n      background-attachment: scroll;\n      color: white;\n      text-align: center;\n      font-family: \u002718 Khebrat Musamim\u0027, serif;\n      margin: 0;\n      padding: 0;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      min-height: 100vh;\n    }\n\n    .data-section, .search-section {\n      background-color: rgba(0, 0, 0, 0.7);\n      padding: 20px;\n      border-radius: 15px;\n      text-align: center;\n      margin: 20px;\n      width: 90%;\n      max-width: 600px;\n    }\n\n    h2 {\n      font-size: 2em;\n      text-shadow: 2px 2px 5px #000000;\n    }\n\n    label {\n      font-size: 1.2em;\n      margin-right: 10px;\n      text-align: right;\n      width: 100px;\n    }\n\n    input, button {\n      font-size: 1.2em;\n      font-family: \u002718 Khebrat Musamim\u0027, serif;\n      text-align: center;\n      padding: 10px;\n      width: 100%;\n      margin-top: 10px;\n    }\n\n    .form-group {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      margin-bottom: 20px;\n    }\n\n    .table-container {\n      overflow-x: auto;\n      width: 100%;\n    }\n\n    table {\n      width: 100%;\n      margin-top: 30px;\n      border-collapse: collapse;\n      display: none;\n      font-family: \u002718 Khebrat Musamim\u0027, serif;\n      font-size: 1.2em;\n      direction: rtl;\n    }\n\n    th, td {\n      border: 1px solid white;\n      padding: 15px;\n      text-align: center;\n    }\n\n    .suggestion-item {\n      cursor: pointer;\n      padding: 5px;\n      border-bottom: 1px solid #ccc;\n    }\n\n    .suggestion-item:hover {\n      background-color: #f0f0f0;\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cscript src\u003d\"script.js\"\u003e\u003c/script\u003e \n  \u003cdiv id\u003d\"login-section\"\u003e\n    \u003ch2\u003eLogin\u003c/h2\u003e\n    \u003cform id\u003d\"loginForm\"\u003e\n      \u003cdiv class\u003d\"highlight-box\"\u003e\n        \u003clabel for\u003d\"username\"\u003eUsername:\u003c/label\u003e\n        \u003cinput type\u003d\"text\" id\u003d\"username\" name\u003d\"username\" style\u003d\"font-size: 1.2em; width: 80%;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"highlight-box\"\u003e\n        \u003clabel for\u003d\"password\"\u003ePassword:\u003c/label\u003e\n        \u003cinput type\u003d\"password\" id\u003d\"password\" name\u003d\"password\" style\u003d\"font-size: 1.2em; width: 80%;\"\u003e\n      \u003c/div\u003e\n      \u003cbutton type\u003d\"button\" onclick\u003d\"login()\" style\u003d\"font-size: 1.2em;\"\u003eLogin\u003c/button\u003e\n    \u003c/form\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"data-section\" style\u003d\"display: none;\" id\u003d\"main-section\"\u003e\n    \u003ch2\u003eHeroes adventure 2025\u003c/h2\u003e\n    \u003cform id\u003d\"dataForm\"\u003e\n      \u003cdiv class\u003d\"form-group\"\u003e\n        \u003clabel for\u003d\"name\"\u003eالاسم\u003c/label\u003e\n        \u003cinput type\u003d\"text\" id\u003d\"name\" name\u003d\"name\" placeholder\u003d\"ادخل الاسم\" style\u003d\"font-size: 1.2em;\" list\u003d\"namesList\"\u003e\n        \u003cdatalist id\u003d\"namesList\"\u003e\n          \u003c?!\u003d allNames ? allNames.map(name \u003d\u003e `\u003coption value\u003d\"${name}\"\u003e\u003c/option\u003e`).join(\u0027\u0027) : \u0027\u0027 ?\u003e\n        \u003c/datalist\u003e\n      \u003c/div\u003e\n      \u003cdiv class\u003d\"form-group\"\u003e\n        \u003clabel for\u003d\"grade\"\u003eالدرجة\u003c/label\u003e\n        \u003cinput type\u003d\"number\" id\u003d\"grade\" name\u003d\"grade\" placeholder\u003d\"ادخل الرقم\" min\u003d\"0\" max\u003d\"5\" required style\u003d\"font-size: 1.2em;\"\u003e\n      \u003c/div\u003e\n      \u003cbutton type\u003d\"submit\" style\u003d\"font-size: 1.2em;\"\u003eSubmit\u003c/button\u003e\n    \u003c/form\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\"search-section\" style\u003d\"display: none;\"\u003e\n    \u003ch2\u003eSearch for data\u003c/h2\u003e\n    \u003cdiv class\u003d\"form-group\"\u003e\n      \u003clabel for\u003d\"search\"\u003eالاسم\u003c/label\u003e\n      \u003cinput type\u003d\"text\" id\u003d\"search\" name\u003d\"search\" placeholder\u003d\"ادخل الاسم\" style\u003d\"font-size: 1.2em;\" autocomplete\u003d\"off\"\u003e\n      \u003cdiv id\u003d\"suggestions\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n    \u003cbutton type\u003d\"button\" onclick\u003d\"searchName()\" style\u003d\"font-size: 1.2em;\"\u003eSearch\u003c/button\u003e\n    \u003cdiv class\u003d\"table-container\"\u003e\n      \u003ctable id\u003d\"resultTable\" class\u003d\"table-visible\"\u003e\n        \u003cthead\u003e\n          \u003ctr\u003e\n            \u003cth\u003eالاسم\u003c/th\u003e\n            \u003cth\u003eالاسبوع الاول\u003c/th\u003e\n            \u003cth\u003eالاسبوع الثانى\u003c/th\u003e\n            \u003cth\u003eالاسبوع الثالث\u003c/th\u003e\n            \u003cth\u003eالاسبوع الرابع\u003c/th\u003e\n            \u003cth\u003eالاسبوع الخامس\u003c/th\u003e\n            \u003cth\u003eالاسبوع السادس\u003c/th\u003e\n            \u003cth\u003eالاسبوع السابع\u003c/th\u003e\n            \u003cth\u003eالاسبوع الثامن\u003c/th\u003e\n            \u003cth\u003eالاسبوع التاسع\u003c/th\u003e\n          \u003c/tr\u003e\n        \u003c/thead\u003e\n        \u003ctbody\u003e\n          \u003c!-- Table will be dynamically filled with search results --\u003e\n        \u003c/tbody\u003e\n      \u003c/table\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cscript\u003e\n    google.script.run.withSuccessHandler(setupAutocomplete).getAllNames();\n\n    function setupAutocomplete(names) {\n      const searchInput \u003d document.getElementById(\"search\");\n      const suggestions \u003d document.getElementById(\"suggestions\");\n\n      searchInput.addEventListener(\"input\", function () {\n        const inputValue \u003d searchInput.value.toLowerCase();\n        suggestions.innerHTML \u003d \"\";\n\n        if (inputValue.trim() \u003d\u003d\u003d \"\") return;\n\n        names.forEach(name \u003d\u003e {\n          if (name.toLowerCase().includes(inputValue)) {\n            const suggestionItem \u003d document.createElement(\"div\");\n            suggestionItem.innerHTML \u003d name;\n            suggestionItem.className \u003d \"suggestion-item\";\n            suggestionItem.onclick \u003d function () {\n              searchInput.value \u003d name;\n              suggestions.innerHTML \u003d \"\";\n            };\n            suggestions.appendChild(suggestionItem);\n          }\n        });\n      });\n    }\n\u003cscript\u003e\n  function login() { \n    const username \u003d document.getElementById(\u0027username\u0027).value.trim(); \n    const password \u003d document.getElementById(\u0027password\u0027).value.trim(); \n\n    console.log(`Username: ${username}, Password: ${password}`); // تحقق من القيم في الـ Console\n\n    if (username \u003d\u003d\u003d \u0027John-2020\u0027 \u0026\u0026 password \u003d\u003d\u003d \u0027viscabarca\u0027) { \n      alert(\u0027Login successful!\u0027); \n      document.getElementById(\u0027login-section\u0027).style.display \u003d \u0027none\u0027; \n      document.getElementById(\u0027main-section\u0027).style.display \u003d \u0027block\u0027; \n      document.querySelector(\u0027.search-section\u0027).style.display \u003d \u0027block\u0027; \n\n      console.log(\"Login successful! Sections are now visible.\");\n    } else { \n      alert(\u0027Invalid username or password.\u0027); \n      console.log(\"Invalid login attempt.\");\n    } \n  }\n\u003c/script\u003e\n\n    function searchName() {\n      const name \u003d document.getElementById(\u0027search\u0027).value;\n      google.script.run.withSuccessHandler(showResults).searchName(spreadsheetId, sheetName, name);\n    }\n\n    function showResults(result) {\n      const tableBody \u003d document.getElementById(\u0027resultTable\u0027).querySelector(\u0027tbody\u0027);\n      tableBody.innerHTML \u003d \"\";\n\n      if (result.found) {\n        const data \u003d result.data;\n        const row \u003d document.createElement(\u0027tr\u0027);\n        row.innerHTML \u003d `\u003ctd\u003e${data[0]}\u003c/td\u003e` + data.slice(1).map(val \u003d\u003e `\u003ctd\u003e${val || 0}\u003c/td\u003e`).join(\u0027\u0027);\n        tableBody.appendChild(row);\n        document.getElementById(\u0027resultTable\u0027).style.display \u003d \u0027table\u0027;\n      } else {\n        document.getElementById(\u0027resultTable\u0027).style.display \u003d \u0027none\u0027;\n        alert(\u0027الاسم غير موجود.\u0027);\n      }\n    }\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"}]}